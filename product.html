<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ„›æ¨‚å”¯ï¼šé¨å£«çš„é«”å…§æ·¨åŒ–ä¹‹æ—… (è¨ˆæ™‚æŒ‘æˆ°)</title>
    <style>
        /* å®Œå…¨ä¿ç•™æ‚¨åŸæœ¬çš„æ‰€æœ‰ CSS æ¨£å¼ */
        :root {
            --color-knight: #6a4c93; 
            --color-clear: #4ea8de; 
            --color-adjust: #f48c06; 
            --color-supplement: #2a9d8f; 
            --color-shape: #f72585; 
            --color-bg: #f8f9fa;
            --color-text: #333;
            --color-timer: #ff5733; 
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #a7e9af 0%, #47a0ff 100%);
            color: var(--color-text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box; 
        }

        .game-container {
            background: white;
            width: 100%;
            max-width: 700px;
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            overflow: hidden;
            position: relative;
        }

        .header {
            background: var(--color-knight);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .header h1 { margin: 0; font-size: 1.8rem; }
        .header p { margin: 5px 0 0; opacity: 0.9; font-size: 1rem; }

        .progress-bar { height: 8px; background: #ddd; width: 100%; }
        
        .progress-fill {
            height: 100%;
            background: var(--color-shape);
            width: 0%;
            transition: width 0.4s ease;
        }

        .content {
            padding: 30px;
            text-align: center;
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .btn {
            background: var(--color-knight);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.1s, background 0.2s;
            width: 90%;
            max-width: 350px;
            font-weight: bold;
            text-decoration: none; 
            display: inline-block; 
        }

        .btn:hover { transform: scale(1.03); background: #553c7a; }
        .btn:active { transform: scale(0.98); }

        .btn-home {
            background: #444 !important;
            margin-top: 15px;
        }
        .btn-home:hover {
            background: #222 !important;
        }

        .option-btn {
            background: var(--color-bg);
            color: var(--color-text);
            border: 2px solid #ddd;
            font-size: 1rem;
        }
        
        .option-btn:hover {
            border-color: var(--color-clear);
            background: #e6f7ff;
        }
        
        .difficulty-btn {
            background: #f0f0f0;
            color: #333;
            border: 2px solid #ccc;
            padding: 15px;
            margin: 10px;
            width: 80%;
            max-width: 300px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .difficulty-btn:hover {
            background: #fff;
            border-color: var(--color-knight);
            transform: scale(1.03);
        }

        #timerDisplay {
            font-size: 3rem;
            font-weight: 900;
            color: var(--color-timer);
            margin-bottom: 15px;
            min-height: 48px; 
        }
        
        .level-badge {
            background: var(--color-shape);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 1rem;
            margin-bottom: 20px;
            display: inline-block;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .question-text {
            font-size: 1.35rem;
            margin-bottom: 30px;
            line-height: 1.6;
            font-weight: 500;
        }
        .question-info {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin-bottom: 20px;
            gap: 20px; 
        }
        
        #productPlaceholder img {
            max-width: 100%;
            max-height: 150px;
            border-radius: 8px;
            object-fit: contain; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .enemy-placeholder {
            min-width: 120px;
            text-align: left;
            padding: 10px;
            border-left: 2px solid #eee;
        }
        .enemy-placeholder div { font-size: 1.1rem; font-weight: bold; color: var(--color-knight); }
        .enemy-placeholder span { font-size: 0.9rem; color: #777; font-weight: 600; }
        
        .feedback {
            display: none;
            margin-top: 25px;
            padding: 20px;
            border-radius: 15px;
            text-align: left;
            width: 100%;
            max-width: 500px;
        }
        .feedback.correct { border: 2px solid var(--color-supplement); color: #006d5b; background: #e0f2f1; }
        .feedback.wrong { border: 2px solid var(--color-shape); color: #721c24; background: #f8d7da; }
        .result-score { font-size: 3.5rem; color: var(--color-knight); font-weight: 900; }
        .character-display { font-size: 8rem; margin-bottom: 20px; line-height: 1; }
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 600px) {
            .question-info { flex-direction: column; }
            .enemy-placeholder { border-left: none; border-top: 2px solid #eee; padding-top: 15px; text-align: center; }
        }
    </style>
</head>
<body>

<div class="game-container">
    <div class="header">
        <h1>âš”ï¸ é¨å£«çš„é«”å…§æ·¨åŒ–ä¹‹æ—… ğŸ‘¸</h1>
        <p>é‹ç”¨ã€æ¸…ï¼èª¿ï¼è£œï¼æœ”ã€‘æ™ºæ…§ï¼Œæ‹¯æ•‘å¹³è¡¡å…¬ä¸»ï¼</p>
    </div>
    
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <div id="startScreen" class="content fade-in">
        <div class="character-display princess-initial">ğŸ‘¸ğŸ¿</div>
        <h2>ã€äºå¥åº·å…¬ä¸»ã€‘è¢«å›°</h2>
        <p>è«‹é¸æ“‡æ‚¨çš„æŒ‘æˆ°é›£åº¦ï¼Œç‚ºå…¬ä¸»å¥ªå›å¥åº·å…‰å½©ï¼</p>
        <p style="font-weight: bold; color: var(--color-timer);">â³ ä½œç­”æ™‚é–“ï¼šæ¯é¡Œ 15 ç§’</p>
        
        <button class="btn difficulty-btn" onclick="startGame('easy')">ç°¡å–® (10 é¡Œ) - è™¹å…‰ä¹‹è·¯</button>
        <button class="btn difficulty-btn" onclick="startGame('medium')">æœ‰æŒ‘æˆ° (15 é¡Œ) - æ¥µå…‰ä¹‹è·¯</button>
        <button class="btn difficulty-btn" onclick="startGame('hard')">å°ˆæ¥­ (20 é¡Œ) - æ—¥å…‰ä¹‹è·¯</button>
        
        <a href="index.html" class="btn btn-home">ğŸ  å›åˆ°å¤§å»³é¸å–®</a>
    </div>

    <div id="gameScreen" class="content hidden fade-in">
        <div id="timerDisplay">15</div>
        <div id="animationArea" class="character-display knight">âš”ï¸</div>
        <span id="levelBadge" class="level-badge">é—œå¡è¼‰å…¥ä¸­...</span>
        
        <div class="question-info">
            <div id="productPlaceholder"></div>
            <div id="enemyPlaceholder" class="enemy-placeholder"></div>
        </div>
        <div id="questionText" class="question-text"></div>
        <div id="optionsContainer" style="width: 100%; display: flex; flex-direction: column; align-items: center;"></div>
        
        <div id="feedbackArea" class="feedback">
            <h3 id="feedbackTitle" style="margin-top:0;"></h3>
            <p id="feedbackText" style="margin-bottom:0;"></p>
            <button class="btn" id="nextBtn" onclick="nextQuestion()" style="margin-top: 15px;">ä¸‹ä¸€é¡Œ</button>
        </div>
    </div>

    <div id="resultScreen" class="content hidden fade-in">
        <div id="finalCharacterDisplay" class="character-display">ğŸ‘¸ğŸ¿</div>
        <h2>é—–é—œçµæœæ­æ›‰ï¼</h2>
        <div class="result-score" id="finalScore">0</div>
        <p class="result-message" id="resultMessage"></p>
        <button class="btn" onclick="restartGame()">å†æ¬¡æŒ‘æˆ°</button>
        
        <a href="index.html" class="btn btn-home">ğŸ  è¿”å›å¤§å»³é¸å–®</a>
    </div>
</div>

<script>
    const TIMER_LIMIT = 15; 
    const MAX_SCORE_PER_QUESTION = 10;

    // è¨­å®šé¡Œç›®æŠ½å–æ¯”ä¾‹
    const difficultySettings = {
        'easy': { count: 10, titlePerfect: "æ„›æ¨‚å”¯è™¹å…‰é¨å£«", draw: { 'clear': 3, 'adjust': 2, 'supplement': 2, 'shape': 2, 'final': 1 } },
        'medium': { count: 15, titlePerfect: "æ„›æ¨‚å”¯æ¥µå…‰é¨å£«", draw: { 'clear': 4, 'adjust': 3, 'supplement': 4, 'shape': 3, 'final': 1 } },
        'hard': { count: 20, titlePerfect: "æ„›æ¨‚å”¯æ—¥å…‰é¨å£«", draw: { 'clear': 5, 'adjust': 5, 'supplement': 5, 'shape': 3, 'final': 2 } }
    };

    // æ“´å……å¾Œçš„é¡Œåº«
    const fullQuestionBank = {
        'clear': [
            { level: "ç¬¬ä¸€é—œï¼šæ·¨åŒ–æ£®æ— (æ¸…)", levelColor: "var(--color-clear)", product: "Auro æ¥µæ·¨çº–æœç²‰", enemy: "å®¿ä¾¿æ€ª", imageFile: "clear2.jpg", question: "æ¥µæ·¨çº–æœç²‰ä¸­ï¼Œèƒ½å¹«åŠ©ç¶­æŒæ¶ˆåŒ–é“æ©Ÿèƒ½çš„çè²´è‰æœ¬ç²¾è¯æ˜¯ï¼Ÿ", options: ["ç¶ å’–å•¡", "æœ›æ±Ÿå—å’Œæ±ºæ˜å­", "è† åŸè›‹ç™½", "ç¶­ç”Ÿç´  C"], correct: 1, explanation: "âœ… æ­£ç¢ºï¼**æœ›æ±Ÿå—å’Œæ±ºæ˜å­**å¹«åŠ©ç¶­æŒæ¶ˆåŒ–é“æ©Ÿèƒ½ã€‚" },
            { level: "ç¬¬ä¸€é—œï¼šæ·¨åŒ–æ£®æ— (æ¸…)", levelColor: "var(--color-clear)", product: "Down Bliss æ˜•æ‚…æ´»åŠ›é£²", enemy: "ç²¾ç¥ä¸æ¿Ÿ", imageFile: "clear1.jpg", question: "æ˜•æ‚…æ´»åŠ›é£²ä¸­ï¼Œè¢«ç¨±ç‚ºã€Œå·´è¥¿åœ‹é£²ã€ä¸”å¯Œå«å¤©ç„¶å’–å•¡å› çš„æˆåˆ†æ˜¯ï¼Ÿ", options: ["ç¶ èŒ¶èƒå–", "å·´è¥¿ç“œæ‹¿ç´æœ", "ç‘ªå¡", "è–‘é»ƒç´ "], correct: 1, explanation: "âœ… æ­£ç¢ºï¼**å·´è¥¿ç“œæ‹¿ç´æœ**èƒ½æ»‹è£œå¼·èº«ã€‚" },
            { level: "ç¬¬ä¸€é—œï¼šæ·¨åŒ–æ£®æ— (æ¸…)", levelColor: "var(--color-clear)", product: "Auro æ¥µæ·¨çº–æœç²‰", enemy: "ä»£è¬è² æ“”", imageFile: "clear2.jpg", question: "æ¥µæ·¨çº–æœç²‰ä¸»è¦çš„è¨­è¨ˆæ ¸å¿ƒæ˜¯å¹«åŠ©èº«é«”é€²è¡Œä»€éº¼å‹•ä½œï¼Ÿ", options: ["å¢åŠ è‚Œè‚‰", "é«”å…§ç’°ä¿èˆ‡æ·¨åŒ–", "ç¾ç™½è‚Œè†š", "å¢åŠ é£Ÿæ…¾"], correct: 1, explanation: "âœ… æ­£ç¢ºï¼ã€Œæ¸…ã€çš„æ ¸å¿ƒå°±æ˜¯é€éçº–æœç²‰é€²è¡Œ**é«”å…§ç’°ä¿**ã€‚" },
            { level: "ç¬¬ä¸€é—œï¼šæ·¨åŒ–æ£®æ— (æ¸…)", levelColor: "var(--color-clear)", product: "Down Bliss æ˜•æ‚…æ´»åŠ›é£²", enemy: "è² èƒ½é‡", imageFile: "clear1.jpg", question: "æ´»åŠ›é£²åœ¨ã€Œæ¸…ã€èª¿ã€è£œã€æœ”ã€ä¸­ï¼Œé™¤äº†è£œè¶³èƒ½é‡ä¹Ÿå…·å‚™ä»€éº¼ç‰¹è³ªï¼Ÿ", options: ["æ¸…çˆ½ä»£è¬", "å¢åŠ è„‚è‚ª", "å»¶ç·©ç¡çœ ", "æ¸›å°‘æ°´åˆ†"], correct: 0, explanation: "âœ… æ­£ç¢ºï¼æ´»åŠ›é£²èƒ½å¸¶ä¾†**æ¸…çˆ½ä»£è¬**çš„å‹•åŠ›ã€‚" },
            { level: "ç¬¬ä¸€é—œï¼šæ·¨åŒ–æ£®æ— (æ¸…)", levelColor: "var(--color-clear)", product: "Auro æ¥µæ·¨çº–æœç²‰", enemy: "æ’ä¾¿ä¸é †", imageFile: "clear2.jpg", question: "æ¥µæ·¨çº–æœç²‰å«æœ‰è±å¯Œçš„ï¼Ÿ", options: ["è›‹ç™½è³ª", "è†³é£Ÿçº–ç¶­", "è„‚è‚ª", "æ¾±ç²‰"], correct: 1, explanation: "âœ… æ­£ç¢ºï¼**è†³é£Ÿçº–ç¶­**æ˜¯é«”å…§ç’°ä¿çš„é—œéµã€‚" }
        ],
        'adjust': [
            { level: "ç¬¬äºŒé—œï¼šå¹³è¡¡èŠ±åœ’ (èª¿)", levelColor: "var(--color-adjust)", product: "PurBio æ¾„ç†™ç›Šç”ŸèŒ", enemy: "å£èŒè»åœ˜", imageFile: "adjust.jpg", question: "PurBio æ¾„ç†™ç›Šç”ŸèŒå«æœ‰å¹¾ç¨®å…·èº«åˆ†å±¥æ­·çš„å¼·å¤§èŒæ ªï¼Ÿ", options: ["5 ç¨®", "10 ç¨®", "17 ç¨®", "25 ç¨®"], correct: 2, explanation: "âœ… æ­£ç¢ºï¼**17 ç¨®**ç›ŠèŒæˆ°éšŠèƒ½æ”¹è®Šç´°èŒå¢ç”Ÿæ…‹ã€‚" },
            { level: "ç¬¬äºŒé—œï¼šå¹³è¡¡èŠ±åœ’ (èª¿)", levelColor: "var(--color-adjust)", product: "PurBio æ¾„ç†™ç›Šç”ŸèŒ", enemy: "é«”è³ªå¤±èª¿", imageFile: "adjust.jpg", question: "ç›Šç”ŸèŒåœ¨ã€Œèª¿ã€çš„éšæ®µä¸­ï¼Œæœ€ä¸»è¦çš„ä½œç”¨æ˜¯ï¼Ÿ", options: ["è£œå……ç†±é‡", "èª¿æ•´é«”è³ªèˆ‡èŒå¢å¹³è¡¡", "å¢åŠ é«”é‡", "å¹«åŠ©ç¡çœ "], correct: 1, explanation: "âœ… æ­£ç¢ºï¼ç›Šç”ŸèŒæ˜¯**èª¿æ•´é«”è³ª**çš„æœ€ä½³é¸æ“‡ã€‚" },
            { level: "ç¬¬äºŒé—œï¼šå¹³è¡¡èŠ±åœ’ (èª¿)", levelColor: "var(--color-adjust)", product: "PurBio æ¾„ç†™ç›Šç”ŸèŒ", enemy: "æ¶ˆåŒ–å›°æ“¾", imageFile: "adjust.jpg", question: "PurBio ç›Šç”ŸèŒæ¡ç”¨ä½•ç¨®æŠ€è¡“ç¢ºä¿æ´»èŒåˆ°é”ï¼Ÿ", options: ["é«˜æº«çƒ˜ç„™", "å°ˆåˆ©åŒ…åŸ‹æŠ€è¡“", "å†·å‡ä¹¾ç‡¥", "è‡ªç„¶æ›æ›¬"], correct: 1, explanation: "âœ… æ­£ç¢ºï¼**å°ˆåˆ©åŒ…åŸ‹æŠ€è¡“**èƒ½ä¿è­·èŒæ ªæ´»æ€§ã€‚" },
            { level: "ç¬¬äºŒé—œï¼šå¹³è¡¡èŠ±åœ’ (èª¿)", levelColor: "var(--color-adjust)", product: "PurBio æ¾„ç†™ç›Šç”ŸèŒ", enemy: "ç’°å¢ƒå¹²æ“¾", imageFile: "adjust.jpg", question: "å¥åº·çš„è…¸é“èŒå¢å¹³è¡¡ï¼Œæœ‰åŠ©æ–¼ç¶­æŒï¼Ÿ", options: ["éª¨éª¼ç¡¬åº¦", "ç”Ÿç†æ©Ÿèƒ½èˆ‡é˜²è­·åŠ›", "è¨˜æ†¶åŠ›", "è¦–åŠ›"], correct: 1, explanation: "âœ… æ­£ç¢ºï¼è…¸é“æ˜¯äººé«”é‡è¦çš„é˜²è­·é˜²ç·šã€‚" },
            { level: "ç¬¬äºŒé—œï¼šå¹³è¡¡èŠ±åœ’ (èª¿)", levelColor: "var(--color-adjust)", product: "PurBio æ¾„ç†™ç›Šç”ŸèŒ", enemy: "æ•æ„Ÿæƒ…ç·’", imageFile: "adjust.jpg", question: "æ¾„ç†™ç›Šç”ŸèŒé™¤äº†æ¶ˆåŒ–ï¼Œå°å“ªæ–¹é¢ä¹Ÿæœ‰èª¿æ•´ä½œç”¨ï¼Ÿ", options: ["è‚Œè‚‰ç™¼å±•", "ç”Ÿç†èª¿ç¯€å¹³è¡¡", "é ­é«®ç”Ÿé•·", "èº«é«˜"], correct: 1, explanation: "âœ… æ­£ç¢ºï¼å„ªè³ªèŒæ ªæœ‰åŠ©æ–¼æ•´é«”çš„**ç”Ÿç†èª¿ç¯€**ã€‚" }
        ],
        'supplement': [
            { level: "ç¬¬ä¸‰é—œï¼šèƒ½é‡æ³‰æº (è£œ)", levelColor: "var(--color-supplement)", product: "Flor äº®å¦å¬Œæºé£²", enemy: "ä¹¾ç‡¥ç´°ç´‹", imageFile: "supplement1.jpg", question: "äº®å¦å¬Œæºé£²ä¸­ï¼Œä¸€åŒ…è˜Šå«å¤šå°‘æ¯«å…‹çš„é­šè† åŸè›‹ç™½ï¼Ÿ", options: ["1,000", "5,000", "10,000", "2,500"], correct: 1, explanation: "âœ… æ­£ç¢ºï¼å«æœ‰ **5,000 æ¯«å…‹**ã€‚" },
            { level: "ç¬¬ä¸‰é—œï¼šèƒ½é‡æ³‰æº (è£œ)", levelColor: "var(--color-supplement)", product: "Etern æ†èŠ¯ç‡Ÿé¤Šç²‰", enemy: "éª¨éª¼å¥åº·", imageFile: "supplement2.jpg", question: "ä¾†è‡ªç‰›ä¹³èƒå–ï¼Œèƒ½è¼”åŠ©ç¶­æŒéª¨éª¼å¥åº·çš„æ´»æ€§èƒœè‚½æˆåˆ†æ˜¯ï¼Ÿ", options: ["é«˜éˆ£ä¹³é…ª", "ç‰›å¥¶æ´»æ€§èƒœè‚½MBP", "å¤§è±†èƒå–", "ç¶­ç”Ÿç´  K2"], correct: 1, explanation: "âœ… æ­£ç¢ºï¼**ç‰›å¥¶æ´»æ€§èƒœè‚½MBP**é©åˆè¼”åŠ©éª¨éª¼å¥åº·ã€‚" },
            { level: "ç¬¬ä¸‰é—œï¼šèƒ½é‡æ³‰æº (è£œ)", levelColor: "var(--color-supplement)", product: "Flor äº®å¦å¬Œæºé£²", enemy: "è† åŸæµå¤±", imageFile: "supplement1.jpg", question: "äº®å¦å¬Œæºé£²é¸ç”¨å“ªç¨®ä¾†æºçš„è† åŸè›‹ç™½æ›´æ˜“å¸æ”¶ï¼Ÿ", options: ["è±¬çš®", "ç‰›éª¨", "é­šé±—èƒå–(å°åˆ†å­)", "å¤§è±†"], correct: 2, explanation: "âœ… æ­£ç¢ºï¼**é­šé±—èƒå–çš„å°åˆ†å­**èƒœè‚½å¸æ”¶åº¦æ›´ä½³ã€‚" },
            { level: "ç¬¬ä¸‰é—œï¼šèƒ½é‡æ³‰æº (è£œ)", levelColor: "var(--color-supplement)", product: "Etern æ†èŠ¯ç‡Ÿé¤Šç²‰", enemy: "ç‡Ÿé¤Šç¼ºä¹", imageFile: "supplement2.jpg", question: "æ†èŠ¯ç‡Ÿé¤Šç²‰ä¸»è¦çš„ç”¢å“ç‰¹è‰²æ˜¯ï¼Ÿ", options: ["é«˜ç³–åˆ†", "å…¨æ–¹ä½ç‡Ÿé¤Šè£œçµ¦", "åªæœ‰ç¶­ç”Ÿç´ A", "åªæœ‰æ²¹è„‚"], correct: 1, explanation: "âœ… æ­£ç¢ºï¼æä¾›é¨å£«**å…¨æ–¹ä½çš„ç‡Ÿé¤Šè£œçµ¦**ã€‚" },
            { level: "ç¬¬ä¸‰é—œï¼šèƒ½é‡æ³‰æº (è£œ)", levelColor: "var(--color-supplement)", product: "Flor äº®å¦å¬Œæºé£²", enemy: "æ­²æœˆç—•è·¡", imageFile: "supplement1.jpg", question: "äº®å¦å¬Œæºé£²å»ºè­°é£²ç”¨çš„æ™‚æ©Ÿï¼Ÿ", options: ["åªæœ‰é‹å‹•å¾Œ", "ç©ºè…¹æˆ–ç¡å‰", "åƒé£¯ä¸­", "å–é…’å¾Œ"], correct: 1, explanation: "âœ… æ­£ç¢ºï¼**ç©ºè…¹æˆ–ç¡å‰**æ˜¯è† åŸè›‹ç™½å¸æ”¶çš„å¥½æ™‚æ©Ÿã€‚" },
            { level: "ç¬¬ä¸‰é—œï¼šèƒ½é‡æ³‰æº (è£œ)", levelColor: "var(--color-supplement)", product: "Etern æ†èŠ¯ç‡Ÿé¤Šç²‰", enemy: "è‚ŒåŠ›æµå¤±", imageFile: "supplement2.jpg", question: "æ†èŠ¯ç‡Ÿé¤Šç²‰å«æœ‰å„ªè³ªçš„ï¼Ÿ", options: ["è†½å›ºé†‡", "è›‹ç™½è³ªèˆ‡èƒºåŸºé…¸", "åå¼è„‚è‚ª", "äººå·¥é¦™æ–™"], correct: 1, explanation: "âœ… æ­£ç¢ºï¼**å„ªè³ªè›‹ç™½**æ˜¯è£œçµ¦çš„é‡é»ã€‚" }
        ],
        'shape': [
            { level: "ç¬¬å››é—œï¼šå¡‘å½¢ç¥æ®¿ (æœ”)", levelColor: "var(--color-shape)", product: "Spork é–ƒæœ”èœœæ¡ƒé£²", enemy: "é«”è„‚é­”ç‹", imageFile: "shape1.jpg", question: "å“ªç¨®æˆåˆ†å«æœ‰è±å¯Œ HCAï¼Œèƒ½é™ä½å°é£Ÿç‰©çš„æ…¾æœ›ï¼Ÿ", options: ["ç¶ å’–å•¡", "è—¤é»ƒæœèƒå–", "è‘¡è„çš®", "å…’èŒ¶ç´ "], correct: 1, explanation: "âœ… æ­£ç¢ºï¼**è—¤é»ƒæœèƒå–ç‰©**æ˜¯å¥½å¹«æ‰‹ã€‚" },
            { level: "ç¬¬å››é—œï¼šå¡‘å½¢ç¥æ®¿ (æœ”)", levelColor: "var(--color-shape)", product: "Spork é–ƒæœ”å¥¶èŒ¶é£²", enemy: "è…¹éƒ¨å †ç©", imageFile: "shape2.jpg", question: "é–ƒæœ”å¥¶èŒ¶é£²ä¸­ç‰¹æœ‰ï¼Œå…·èª¿ç¯€ç”Ÿç†æ©Ÿèƒ½ã€æ¸›å°‘è…¹éƒ¨å †ç©çš„æ˜¯ï¼Ÿ", options: ["ç¶ å’–å•¡", "è—¤é»ƒæœ", "ç™½è—œè˜†é†‡", "å·èŠèƒå–ç‰©"], correct: 3, explanation: "âœ… æ­£ç¢ºï¼**å·èŠèƒå–ç‰©**èƒ½æ¸›å°‘è…¹éƒ¨å †ç©ã€‚" },
            { level: "ç¬¬å››é—œï¼šå¡‘å½¢ç¥æ®¿ (æœ”)", levelColor: "var(--color-shape)", product: "Spork é–ƒæœ”èœœæ¡ƒé£²", enemy: "æ…¾æœ›ç«çƒ", imageFile: "shape1.jpg", question: "ã€Œæœ”ã€çš„ç›®æ¨™åœ¨æ–¼é‡å¡‘é«”æ…‹ï¼Œå¯†æ¡ƒé£²çš„é¢¨å‘³æ˜¯ï¼Ÿ", options: ["è‹¦æ¾€å‘³", "æ¸…æ–°æ°´èœœæ¡ƒ", "æ¿ƒéƒå·§å…‹åŠ›", "è—¥è‰å‘³"], correct: 1, explanation: "âœ… æ­£ç¢ºï¼**æ¸…æ–°æ°´èœœæ¡ƒ**è®“å¡‘å½¢ä¹‹æ—…æ›´æ„‰å¿«ã€‚" }
        ],
        'final': [
             { level: "æœ€çµ‚é—œï¼šå¤§å¸«çš„æ™ºæ…§", levelColor: "var(--color-knight)", product: "é¤é‡ç®¡ç†", enemy: "éŒ¯èª¤è§€å¿µ", imageFile: "clear1.jpg", question: "å£è¨£æ˜¯ã€Œåƒè‚‰è‚‰æ¸›è‚‰è‚‰ï¼å–ç¥é£²æ¸›è‚‰è‚‰ï¼____________ã€ï¼Ÿ", options: ["å¤šé‹å‹•æ¸›è‚‰è‚‰", "ä¸ç”¨å‹•æ¸›è‚‰è‚‰", "å°‘åƒæ¾±ç²‰æ¸›è‚‰è‚‰", "ä¸åƒè‚‰æ¸›è‚‰è‚‰"], correct: 1, explanation: "âœ… æ­£ç¢ºï¼å£è¨£æ˜¯ï¼š**ä¸ç”¨å‹•æ¸›è‚‰è‚‰**ã€‚" },
             { level: "æœ€çµ‚é—œï¼šå¤§å¸«çš„æ™ºæ…§", levelColor: "var(--color-knight)", product: "å¥åº·å¿ƒæ³•", enemy: "å¥åº·è¿·æ€", imageFile: "supplement2.jpg", question: "æ„›æ¨‚å”¯æ¨å»£çš„ã€Œæ¸…èª¿è£œæœ”ã€é †åºï¼Œç‚ºä½•é‡è¦ï¼Ÿ", options: ["æ²’æœ‰é †åºä¹‹åˆ†", "å…ˆæ¸…å†è£œæ•ˆæœåŠ ä¹˜", "éš¨ä¾¿åƒå°±å¯ä»¥", "åªè£œä¸æ¸…æœ€å¥½"], correct: 1, explanation: "âœ… æ­£ç¢ºï¼**å…ˆæ¸…å†è£œ**æ‰èƒ½è®“ç‡Ÿé¤Šå¸æ”¶æœ€æœ‰æ•ˆç‡ã€‚" }
        ]
    };

    let currentQuestions = []; let currentQuestionIndex = 0; let score = 0; let isAnswering = false; let timerInterval = null; let hasAnswered = false; let selectedDifficulty = null; let maxGameScore = 0;

    function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }

    function startGame(difficulty) {
        selectedDifficulty = difficulty; const settings = difficultySettings[difficulty];
        document.getElementById('startScreen').classList.add('hidden');
        document.getElementById('gameScreen').classList.remove('hidden');
        currentQuestionIndex = 0; score = 0; currentQuestions = [];
        maxGameScore = settings.count * MAX_SCORE_PER_QUESTION;

        // æŠ½å–é¡Œç›®é‚è¼¯
        for (const key in settings.draw) {
            const count = settings.draw[key];
            if (fullQuestionBank[key]) {
                const shuffledBank = shuffleArray([...fullQuestionBank[key]]);
                currentQuestions.push(...shuffledBank.slice(0, count));
            }
        }
        
        // å¦‚æœé¡Œç›®ä¸è¶³ï¼Œå¾å…¶ä»–åˆ†é¡è£œè¶³ (é¿å…ç¨‹å¼ç•¶æ‰)
        while(currentQuestions.length < settings.count) {
            const keys = Object.keys(fullQuestionBank);
            const randomKey = keys[Math.floor(Math.random() * keys.length)];
            currentQuestions.push(fullQuestionBank[randomKey][0]);
        }

        currentQuestions = shuffleArray(currentQuestions).map(q => {
            const correctText = q.options[q.correct];
            const newOpts = shuffleArray([...q.options]);
            return { ...q, options: newOpts, correct: newOpts.indexOf(correctText) };
        });
        showQuestion();
    }

    function showQuestion() {
        isAnswering = true; hasAnswered = false;
        document.getElementById('feedbackArea').style.display = 'none';
        if (timerInterval) clearInterval(timerInterval);
        const q = currentQuestions[currentQuestionIndex];
        document.getElementById('levelBadge').textContent = `${q.level} (${currentQuestionIndex + 1}/${currentQuestions.length})`;
        document.getElementById('levelBadge').style.backgroundColor = q.levelColor;
        document.getElementById('questionText').textContent = q.question;
        document.getElementById('productPlaceholder').innerHTML = `<img src="${q.imageFile}" />`;
        document.getElementById('enemyPlaceholder').innerHTML = `<div>${q.product}</div><span>(æ•µ: ${q.enemy})</span>`;
        document.getElementById('progressFill').style.width = `${(currentQuestionIndex / currentQuestions.length) * 100}%`;
        const container = document.getElementById('optionsContainer');
        container.innerHTML = '';
        q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'btn option-btn fade-in';
            btn.textContent = opt;
            btn.onclick = () => checkAnswer(idx);
            container.appendChild(btn);
        });
        startTimer();
    }

    function startTimer() {
        let timeLeft = TIMER_LIMIT;
        const display = document.getElementById('timerDisplay');
        display.textContent = timeLeft;
        display.style.color = 'var(--color-timer)';
        timerInterval = setInterval(() => {
            timeLeft--;
            display.textContent = timeLeft;
            if (timeLeft <= 5) display.style.color = 'red';
            if (timeLeft <= 0) { clearInterval(timerInterval); checkAnswer(-1); }
        }, 1000);
    }

    function checkAnswer(idx) {
        if (!isAnswering || hasAnswered) return;
        clearInterval(timerInterval);
        isAnswering = false; hasAnswered = true;
        const q = currentQuestions[currentQuestionIndex];
        const feedback = document.getElementById('feedbackArea');
        const isCorrect = idx === q.correct;
        if (isCorrect) score += 10;
        feedback.style.display = 'block';
        feedback.className = `feedback ${isCorrect ? 'correct' : 'wrong'} fade-in`;
        document.getElementById('feedbackTitle').textContent = isCorrect ? "ğŸ‰ æˆåŠŸæ“Šæ•—ï¼" : "ğŸ’¥ å—åˆ°é˜»ç¤™ï¼";
        document.getElementById('feedbackText').innerHTML = isCorrect ? q.explanation : `æ­£ç¢ºç­”æ¡ˆï¼š${q.options[q.correct]}<br>${q.explanation}`;
        document.getElementById('nextBtn').textContent = (currentQuestionIndex === currentQuestions.length - 1) ? "æŸ¥çœ‹çµæœ" : "ç¹¼çºŒå‰é€²";
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach((b, i) => {
            b.disabled = true;
            if (i === q.correct) b.style.background = '#2a9d8f';
            else if (i === idx) b.style.background = '#f72585';
        });
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < currentQuestions.length) showQuestion();
        else showResult();
    }

    function showResult() {
        document.getElementById('gameScreen').classList.add('hidden');
        document.getElementById('resultScreen').classList.remove('hidden');
        document.getElementById('finalScore').textContent = score + " åˆ†";
        document.getElementById('progressFill').style.width = '100%';
        const msg = score >= maxGameScore * 0.8 ? "å„ªç§€ï¼å…¬ä¸»å·²æ¢å¾©å…‰å½©ï¼" : "å†æ¥å†å²ï¼Œå…¬ä¸»éœ€è¦ä½ çš„æ™ºæ…§ï¼";
        document.getElementById('resultMessage').textContent = msg;
        // æ ¹æ“šåˆ†æ•¸æ›´æ›å…¬ä¸»ç‹€æ…‹
        const charDisplay = document.getElementById('finalCharacterDisplay');
        charDisplay.textContent = score >= maxGameScore * 0.8 ? "ğŸ‘¸ğŸ»" : "ğŸ‘¸ğŸ¾";
    }

    function restartGame() {
        document.getElementById('resultScreen').classList.add('hidden');
        document.getElementById('startScreen').classList.remove('hidden');
    }
</script>
</body>
</html>